<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/main}">
<head><title>Jajanan - Yummy Market</title></head>
<body>
<div layout:fragment="content">

    <!-- Banner Sambutan -->
    <div class="text-center mb-5 p-5 rounded-5" style="background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); color: white; position: relative; overflow: hidden;">
        <h1 class="display-4 fw-bold mb-2">Mau makan apa hari ini? ğŸ˜‹</h1>
        <p class="fs-5 opacity-75">Temukan makanan lezat di sini.</p>
        <div th:if="${userName}" class="badge bg-white text-danger rounded-pill px-4 py-2 mt-2 shadow-sm">
            Hai, <span th:text="${userName}">User</span>! Selamat Jajan ğŸ‘‹
        </div>
    </div>

    <!-- Grid Produk -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
        
        <!-- Pesan Jika Kosong -->
        <div th:if="${cookies.empty}" class="col-12 text-center py-5">
            <span style="font-size: 60px;">ğŸ½ï¸</span>
            <h4 class="mt-3 text-muted">Belum ada makanan dijual.</h4>
            <p class="text-muted">Penjual belum restock nih.</p>
        </div>

        <!-- Loop Kartu Produk -->
        <!-- PERHATIKAN: th:each="cookie : ${cookies}" -->
        <div class="col" th:each="cookie : ${cookies}">
            <div class="card card-custom h-100 position-relative">
                
                <!-- Badge Stok (Menggunakan Safety Check ?:) -->
                <span class="position-absolute top-0 end-0 m-3 badge rounded-pill shadow-sm"
                      th:classappend="${(cookie.stock ?: 0) > 0} ? 'bg-success' : 'bg-secondary'"
                      th:text="${(cookie.stock ?: 0) > 0} ? 'Ready' : 'Habis'">Ready</span>

                <!-- Gambar -->
                <div style="height: 200px; background: #FFF0F0; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                    <img th:if="${cookie.imagePath != null}" th:src="@{'/uploads/' + ${cookie.imagePath}}" style="width: 100%; height: 100%; object-fit: cover;">
                    <span th:if="${cookie.imagePath == null}" style="font-size: 4rem;">ğŸ±</span>
                </div>

                <div class="card-body d-flex flex-column text-center">
                    <h5 class="fw-bold mb-1 text-dark" th:text="${cookie.name}">Nama Menu</h5>
                    <small class="text-muted mb-3" th:text="${cookie.flavor}">Varian</small>
                    
                    <h4 class="text-danger fw-bold mb-3" th:text="'Rp ' + ${cookie.price}">Rp 0</h4>
                    
                    <div class="mt-auto">
                        <!-- LOGIKA TOMBOL BELI -->
                        
                        <!-- 1. Jika Stok Ada (Pakai Form agar aman) -->
                        <form th:if="${(cookie.stock ?: 0) > 0}" th:action="@{/shop/buy/{id}(id=${cookie.id})}" method="post" target="_blank">
                            <button type="submit" class="btn btn-yummy w-100 rounded-pill" 
                                    onclick="return confirm('Pesan menu ini ke WhatsApp?')">
                                <i class="bi bi-whatsapp me-1"></i> Pesan
                            </button>
                        </form>

                        <!-- 2. Jika Stok Habis -->
                        <button th:if="${(cookie.stock ?: 0) <= 0}" class="btn btn-secondary w-100 rounded-pill" disabled>
                            Sold Out
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>