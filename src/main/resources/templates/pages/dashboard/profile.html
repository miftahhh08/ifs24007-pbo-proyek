<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout/main}">
<head>
    <title>Laporan Toko - Lapar.id</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .profile-container {
            padding: 40px 4%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Profile Card */
        .profile-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.06);
            text-align: center;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #e8ebe4, #d4d9ca);
            color: #8B9556;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto 25px;
            box-shadow: 0 5px 15px rgba(139, 149, 86, 0.2);
        }

        .profile-name {
            font-size: 1.8rem;
            font-weight: 800;
            color: #2d3319;
            margin: 0 0 8px 0;
        }

        .profile-email {
            color: #6b7456;
            font-size: 1rem;
            margin-bottom: 25px;
        }

        .profile-divider {
            margin: 25px 0;
            border: none;
            border-top: 2px solid #f5f7f2;
        }

        .profile-info {
            text-align: left;
            line-height: 2.2;
        }

        .profile-info-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            color: #2d3319;
            font-size: 0.95rem;
        }

        .profile-info-item i {
            width: 24px;
            text-align: center;
            font-size: 1.1rem;
        }

        .info-label {
            color: #6b7456;
            font-weight: 500;
        }

        .info-value {
            font-weight: 700;
            color: #2d3319;
        }

        /* Chart Card */
        .chart-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.06);
        }

        .chart-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
        }

        .chart-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3319;
            margin: 0;
        }

        .chart-icon {
            font-size: 1.8rem;
        }

        .empty-chart {
            text-align: center;
            padding: 60px 20px;
            color: #9ca888;
        }

        .empty-chart i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #d4d9ca;
        }

        .empty-chart p {
            font-size: 1.1rem;
            margin: 0;
        }

        /* Stats Overview */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-box {
            background: white;
            padding: 25px;
            border-radius: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
            border-left: 4px solid #8B9556;
        }

        .stat-box h4 {
            margin: 0 0 10px 0;
            color: #6b7456;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-box .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: #8B9556;
            margin: 0;
        }

        .stat-box .stat-suffix {
            font-size: 0.9rem;
            color: #9ca888;
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 968px) {
            .profile-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .profile-container {
                padding: 20px 4%;
            }

            .profile-card,
            .chart-card {
                padding: 25px 20px;
            }

            .profile-avatar {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }

            .profile-name {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
<div layout:fragment="content" class="profile-container">

    <!-- Main Grid -->
    <div class="profile-grid">
        
        <!-- Profile Info Card -->
        <div class="profile-card">
            <div class="profile-avatar">
                <i class="fas fa-store"></i>
            </div>
            
            <h3 class="profile-name" th:text="${user.shopName ?: user.name}">Nama Toko</h3>
            <p class="profile-email" th:text="${user.email}">email@example.com</p>
            
            <hr class="profile-divider">
            
            <div class="profile-info">
                <div class="profile-info-item">
                    <i class="fas fa-check-circle" style="color: #52c41a;"></i>
                    <span class="info-label">Status:</span>
                    <span class="info-value" style="color: #52c41a;">Aktif</span>
                </div>
                
                <div class="profile-info-item">
                    <i class="fas fa-map-marker-alt" style="color: #8B9556;"></i>
                    <span class="info-label">Lokasi:</span>
                    <span class="info-value" th:text="${user.address ?: 'Belum diatur'}">Kantin Pusat</span>
                </div>
                
                <div class="profile-info-item" th:if="${user.whatsappNumber}">
                    <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                    <span class="info-label">WhatsApp:</span>
                    <span class="info-value" th:text="${user.whatsappNumber}">-</span>
                </div>
                
                <div class="profile-info-item">
                    <i class="fas fa-utensils" style="color: #8B9556;"></i>
                    <span class="info-label">Total Menu:</span>
                    <span class="info-value" th:text="${productCount ?: 0}">0</span>
                </div>
            </div>
        </div>

        <!-- Chart Card -->
        <div class="chart-card">
            <div class="chart-header">
                <span class="chart-icon">ðŸ“Š</span>
                <h3>Menu Terlaris</h3>
            </div>
            
            <!-- Chart Canvas (Only show if has products) -->
            <div th:if="${not #lists.isEmpty(products)}">
                <canvas id="salesChart" style="max-height: 350px;"></canvas>
            </div>
            
            <!-- Empty State -->
            <div th:if="${#lists.isEmpty(products)}" class="empty-chart">
                <i class="fas fa-chart-bar"></i>
                <p>Belum ada data penjualan.</p>
                <p style="font-size: 0.9rem; margin-top: 10px;">Mulai jual dan lihat statistiknya di sini!</p>
            </div>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="stats-grid">
        <div class="stat-box">
            <h4>Total Menu</h4>
            <p class="stat-value" th:text="${productCount ?: 0}">0</p>
            <p class="stat-suffix">Menu Aktif</p>
        </div>
        
        <div class="stat-box">
            <h4>Total Penjualan</h4>
            <p class="stat-value">0</p>
            <p class="stat-suffix">Porsi Terjual</p>
        </div>
        
        <div class="stat-box">
            <h4>Pendapatan</h4>
            <p class="stat-value">Rp 0</p>
            <p class="stat-suffix">Bulan Ini</p>
        </div>
    </div>

    <!-- Chart Script -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        // Get data from Thymeleaf
        const products = /*[[${products}]]*/ [];
        
        if (products && products.length > 0) {
            // Extract product names and simulate sales (nanti diganti dengan data real)
            const productNames = products.map(p => p.name);
            const salesData = products.map(() => Math.floor(Math.random() * 30) + 5); // Dummy data for now
            
            const ctx = document.getElementById('salesChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: productNames,
                    datasets: [{
                        label: 'Terjual (Porsi)',
                        data: salesData,
                        backgroundColor: '#8B9556',
                        borderRadius: 8,
                        borderSkipPadding: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#2d3319',
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#6b7456',
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: '#f5f7f2'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#6b7456',
                                font: {
                                    size: 11
                                },
                                maxRotation: 45,
                                minRotation: 0
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        /*]]>*/
    </script>

</div>
</body>
</html>